# This Template builds a function app project, validates by running unit tests and publishes the code coverage.


parameters:
  - name: functionAppName
  - name: environmentServiceNameAzureRM
  - name: validatePipeline
    default: 'Validate-Azure-Integration'
  - name: projectName
    default: 'AzureIntegration'
    
steps:

  - task: DownloadBuildArtifacts@1
    inputs:
      buildType: 'specific'
      project: '13bb6a66-2e93-47f2-b44e-28619d085240'
      pipeline: '20'
      buildVersionToDownload: 'latest'
      downloadType: 'single'
      artifactName: 'drop'
      downloadPath: '$(System.ArtifactsDirectory)'
      cleanDestinationFolder: true

  #'$(Pipeline.Workspace)/functionappartifact/azure_integration.zip'
  # - publish: $(Pipeline.Workspace)
  #   artifact: Flow

  - task: AzureFunctionApp@1
    displayName: deploy the functions to function_app
    inputs:
      azureSubscription: '${{ parameters.environmentServiceNameAzureRM }}'
      appType: 'functionApp'
      appName: '${{ parameters.functionAppName }}'
      package: $(System.ArtifactsDirectory)/azure_integration.zip
      deploymentMethod: 'auto'

